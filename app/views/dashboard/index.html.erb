<div class="dashboard-container" style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
  
  <!-- Left Column: Upcoming Appointments -->
  <div class="dashboard-column">
    <div class="stat-card" style="margin-bottom: 2rem;">
      <h2><%= Time.current.strftime("%B %Y") %></h2>
      
      <div class="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 1rem; text-align: center;">
        <% %w[S M T W T F S].each do |day| %>
          <div style="font-weight: bold; font-size: 0.8rem; color: var(--text-muted);"><%= day %></div>
        <% end %>
        
        <% 
          start_date = Time.current.beginning_of_month.to_date
          end_date = Time.current.end_of_month.to_date
          first_day_wday = start_date.wday
        %>
        
        <% first_day_wday.times do %>
          <div></div>
        <% end %>
        
        <% (start_date..end_date).each do |date| %>
          <% has_appt = @calendar_consultations.any? { |c| c.date_time.to_date == date } %>
          <div style="padding: 5px; border-radius: 50%; <%= 'background: var(--primary-color); color: white;' if has_appt %> <%= 'border: 1px solid var(--primary-color);' if date == Date.current && !has_appt %>">
            <%= date.day %>
          </div>
        <% end %>
      </div>
    </div>

    <h3><%= t('next_appointments') %></h3>
    <% if @upcoming_appointments.any? %>
      <ul class="consultations-list">
        <% @upcoming_appointments.limit(5).each do |appt| %>
          <li>
            <div class="consultation-info">
              <strong><%= appt.date_time.strftime("%b %d, %H:%M") %></strong>
              <span class="text-muted small"><%= t('patient') %>: <%= link_to appt.patient.name, appt.patient %></span>
              <p><%= appt.location %></p>
            </div>
            <div style="display: flex; gap: 0.5rem;">
              <%= link_to t('open'), patient_consultation_path(appt.patient, appt), class: "button small secondary" %>
              <%= link_to "ðŸ“…", appt.google_calendar_url, class: "button small", target: "_blank", title: t('add_to_google_calendar'), style: "padding: 0.4rem 0.8rem;" if appt.google_calendar_url %>
            </div>
          </li>
        <% end %>
      </ul>
      <% if @upcoming_appointments.count > 5 %>
        <p class="text-muted text-center" style="margin-top: 1rem;"><%= t('and_more', count: @upcoming_appointments.count - 5) %></p>
      <% end %>
    <% else %>
      <p class="text-muted"><%= t('no_upcoming') %></p>
    <% end %>
  </div>

  <!-- Right Column: Patient List -->
  <div class="dashboard-column">
    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h3><%= t('patients') %></h3>
      <%= link_to t('new_patient'), new_patient_path, class: "button primary" %>
    </div>

    <div class="search-bar" style="margin-bottom: 1rem;">
      <%= form_with url: root_path, method: :get, local: true, style: "display: flex; width: 100%; gap: 0.5rem;" do |form| %>
        <%= form.text_field :query, placeholder: t('search_patients'), value: params[:query], class: "search-input form-control" %>
        <%= form.submit t('search'), class: "button secondary" %>
      <% end %>
    </div>

    <div class="patients-table-container">
      <table>
        <thead>
          <tr>
            <th><%= link_to t('name'), root_path(sort: "name", query: params[:query]) %></th>
            <th><%= t('identifier') %></th>
            <th><%= link_to t('registered'), root_path(sort: "created_at", query: params[:query]) %></th>
            <th><%= t('actions') %></th>
          </tr>
        </thead>
        <tbody>
          <% @patients.each do |patient| %>
            <tr>
              <td><%= link_to patient.name, patient %></td>
              <td><%= patient.identifier %></td>
              <td><%= patient.created_at.strftime("%b %d, %Y") %></td>
              <td>
                <%= link_to t('view'), patient, class: "button small secondary" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
