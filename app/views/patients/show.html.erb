<div class="patient-header">
  <div style="display: flex; align-items: center; gap: 1rem;">
    <h1 style="margin: 0;"><%= @patient.name %></h1>
    <%= link_to t('prescribe_pem'), "https://pem.min-saude.pt/web/guest/home?p_p_state=maximized&p_p_mode=view&saveLastPath=false&_58_struts_action=%2Flogin%2Flogin&p_p_id=58&p_p_lifecycle=0&_58_redirect=%2Fpem", 
        class: "button primary", 
        target: "_blank", 
        style: "font-size: 0.9rem;" %>
  </div>
  <%= link_to t('back_to_dashboard'), root_path, class: "button secondary" %>
</div>

<div class="patient-tabs">
  <button class="tab-button active" onclick="openTab(event, 'personal-info')"><%= t('personal_info') %></button>
  <button class="tab-button" onclick="openTab(event, 'exams')"><%= t('exams') %></button>
  <button class="tab-button" onclick="openTab(event, 'consultations')"><%= t('appointments_consultations') %></button>
  <button class="tab-button" onclick="openTab(event, 'documents')"><%= t('documents') %></button>
</div>

<div id="personal-info" class="tab-content active">
  <%= render "personal_info", patient: @patient %>
</div>

<div id="exams" class="tab-content" style="display:none">
  <%= render "exams", patient: @patient %>
</div>

<div id="consultations" class="tab-content" style="display:none">
  <%= render "consultations", patient: @patient %>
</div>

<div id="documents" class="tab-content" style="display:none">
  <%= render "documents", patient: @patient %>
</div>

<script>
function openTab(evt, tabName) {
  var i, tabContent, tabButtons;
  tabContent = document.getElementsByClassName("tab-content");
  for (i = 0; i < tabContent.length; i++) {
    tabContent[i].style.display = "none";
  }
  tabButtons = document.getElementsByClassName("tab-button");
  for (i = 0; i < tabButtons.length; i++) {
    tabButtons[i].className = tabButtons[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  if (evt) {
    evt.currentTarget.className += " active";
  } else {
    // Find button for this tab and make active
    for (i = 0; i < tabButtons.length; i++) {
      if (tabButtons[i].getAttribute('onclick').includes(tabName)) {
        tabButtons[i].className += " active";
      }
    }
  }
  
  // Update URL without reload
  const url = new URL(window.location);
  url.searchParams.set('tab', tabName);
  window.history.pushState({}, '', url);
}

// Check URL params on load and Turbo navigation
document.addEventListener('turbo:load', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const tab = urlParams.get('tab');
  if (tab) {
    openTab(null, tab);
  }
});
</script>
